schema: '2.0'
stages:
  prepare:
    cmd: uv run python src/probafcst/pipeline/prepare.py
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 6d59fa3c8a1c02fca7f10e251db64a2a
      size: 3645
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 4a10769d280f0d261a5c2ec241080c40
      size: 1433
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: ad440470ca62eaef0beb641f52577331
      size: 523826
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: e81ca6530af0d24f63c9e34a16e13479
      size: 3812
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5437a9e458ff6638d74d4273b802a380
      size: 2130
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: 3ac70d9f4f7e56102a9e39b88663b324
      size: 1310583
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: e81ca6530af0d24f63c9e34a16e13479
      size: 3812
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5437a9e458ff6638d74d4273b802a380
      size: 2130
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: 04bd83a3ab1421645963324d0fffc8e5
      size: 63695
  prepare@no2:
    cmd: uv run python src/probafcst/pipeline/prepare.py --target no2
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 9ebb26cb2d17806d29968a9235425167
      size: 3798
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5437a9e458ff6638d74d4273b802a380
      size: 2130
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 3ac70d9f4f7e56102a9e39b88663b324
      size: 1310583
    - path: src/probafcst//models/
      hash: md5
      md5: c620c4e25ca7677545d64077f62554e6.dir
      size: 4237
      nfiles: 2
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 5bd134dca06b246ca2113858bf163ab2
      size: 998
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          benchmark:
            n_weeks: 300
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: b1623fd2c93003d74f1100e9d4c86cf6
      size: 2071732
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 04bd83a3ab1421645963324d0fffc8e5
      size: 63695
    - path: src/probafcst//models/
      hash: md5
      md5: c620c4e25ca7677545d64077f62554e6.dir
      size: 4237
      nfiles: 2
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 5bd134dca06b246ca2113858bf163ab2
      size: 998
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          benchmark:
            n_weeks: 300
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: e1f0f7b813077efb25eca8328756055b
      size: 111578
  train@no2:
    cmd: uv run python src/probafcst/pipeline/train.py --target no2
    deps:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
    - path: src/probafcst//model.py
      hash: md5
      md5: 4012051ff8e014e21b0f2f762341189c
      size: 881
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: b986f3cb2605277a0930bd3c713b38d8
      size: 965
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: models/no2_model.pkl
      hash: md5
      md5: ae97b7c132b660aacc13eb0bf3c76ac5
      size: 1857779
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: e1f0f7b813077efb25eca8328756055b
      size: 111578
    - path: models/energy_model.pkl
      hash: md5
      md5: b1623fd2c93003d74f1100e9d4c86cf6
      size: 2071732
    - path: src/probafcst//plotting.py
      hash: md5
      md5: c90b73d9cc7c851550b5c56ff34224a8
      size: 1489
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: d20f988845fe16468c6b1c2867ed0d3d
      size: 1982
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.png
      hash: md5
      md5: 82e217f3d16efb699ac11e2ca51add56
      size: 64786
    - path: output/energy_forecast.png
      hash: md5
      md5: 6d156adb706afd5b42f56f60952c09cf
      size: 96927
    - path: output/submission.csv
      hash: md5
      md5: 0ac1791ae6c2370e8939e46266ed1f94
      size: 1201
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 3ac70d9f4f7e56102a9e39b88663b324
      size: 1310583
    - path: models/energy_model.pkl
      hash: md5
      md5: b1623fd2c93003d74f1100e9d4c86cf6
      size: 2071732
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: bc0213d6c908a395e9a9695c48bf0f2d
      size: 2344
    params:
      params.yaml:
        eval:
          bikes:
            fh: 31
            initial_window: 730
            step_length: 150
          energy:
            fh: 168
            initial_window: 26280
            step_length: 4320
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: 28ee01d68a2648c4a984dbb56571bfc9
      size: 1046
    - path: output/energy_metrics.json
      hash: md5
      md5: 38ee8cae62e3d610fb18cdff4c61d221
      size: 91
    - path: output/eval_plots/energy/
      hash: md5
      md5: b60f9e6bd45fb7aaa5fde0b1694c084a.dir
      size: 513719
      nfiles: 3
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 04bd83a3ab1421645963324d0fffc8e5
      size: 63695
    - path: models/bikes_model.pkl
      hash: md5
      md5: e1f0f7b813077efb25eca8328756055b
      size: 111578
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: bc0213d6c908a395e9a9695c48bf0f2d
      size: 2344
    params:
      params.yaml:
        eval:
          bikes:
            fh: 31
            initial_window: 730
            step_length: 150
          energy:
            fh: 168
            initial_window: 26280
            step_length: 4320
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: 2ec2e37d1fb2f3a8bb077fd4292f065f
      size: 1859
    - path: output/bikes_metrics.json
      hash: md5
      md5: 99892d78423dc419f4a46e8d9decb47a
      size: 90
    - path: output/eval_plots/bikes/
      hash: md5
      md5: 2d9ca8e4287231de2b8c467a501e0af0.dir
      size: 394423
      nfiles: 3
