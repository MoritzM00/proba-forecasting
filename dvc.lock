schema: '2.0'
stages:
  prepare:
    cmd: uv run python src/probafcst/pipeline/prepare.py
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 6d59fa3c8a1c02fca7f10e251db64a2a
      size: 3645
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 4a10769d280f0d261a5c2ec241080c40
      size: 1433
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: ad440470ca62eaef0beb641f52577331
      size: 523826
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 48e48318cd19332e440bfb5cff5e275d
      size: 2401
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: 60f525b7ac4a6365cd4d3fea91e80cd3
      size: 1332647
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 48e48318cd19332e440bfb5cff5e275d
      size: 2401
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: b959439375eb7d173888ddf4973848bf
      size: 64087
  prepare@no2:
    cmd: uv run python src/probafcst/pipeline/prepare.py --target no2
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 9ebb26cb2d17806d29968a9235425167
      size: 3798
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5437a9e458ff6638d74d4273b802a380
      size: 2130
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 60f525b7ac4a6365cd4d3fea91e80cd3
      size: 1332647
    - path: src/probafcst//models/
      hash: md5
      md5: 96b6bb8c6021b8b14c94473548d90682.dir
      size: 25559
      nfiles: 8
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 9dd71d8d7e71bb386115e9a1d7baa768
      size: 1173
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          selected: xgb-custom
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            freq: h
            output_chunk_length: 24
          xgboost:
            freq: h
            output_chunk_length: 24
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: df5690cdd27db7ceb05eb0765c42d167
      size: 2553083
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: b959439375eb7d173888ddf4973848bf
      size: 64087
    - path: src/probafcst//models/
      hash: md5
      md5: 96b6bb8c6021b8b14c94473548d90682.dir
      size: 25559
      nfiles: 8
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 9dd71d8d7e71bb386115e9a1d7baa768
      size: 1173
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          selected: xgb-custom
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            freq: D
            output_chunk_length: 7
          xgboost:
            freq: D
            output_chunk_length: 7
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 1
            - 2
            - 3
            - 7
            - 14
            - 21
            - 28
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: fd71167879edec0e9fab176597b56697
      size: 1248377
  train@no2:
    cmd: uv run python src/probafcst/pipeline/train.py --target no2
    deps:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
    - path: src/probafcst//model.py
      hash: md5
      md5: 4012051ff8e014e21b0f2f762341189c
      size: 881
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: b986f3cb2605277a0930bd3c713b38d8
      size: 965
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: models/no2_model.pkl
      hash: md5
      md5: ae97b7c132b660aacc13eb0bf3c76ac5
      size: 1857779
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: fd71167879edec0e9fab176597b56697
      size: 1248377
    - path: models/energy_model.pkl
      hash: md5
      md5: df5690cdd27db7ceb05eb0765c42d167
      size: 2553083
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: ef064377b103d2ecc7a95c484fe6a16a
      size: 1947
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.svg
      hash: md5
      md5: 6411ae742d8c6fb120595c90a2a818ed
      size: 27196
    - path: output/energy_forecast.svg
      hash: md5
      md5: ea49a6f276248dd6fd32607e54635c46
      size: 68576
    - path: output/submission.csv
      hash: md5
      md5: d934728cc7b28af1d03178d38c9cc590
      size: 1562
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 60f525b7ac4a6365cd4d3fea91e80cd3
      size: 1332647
    - path: models/energy_model.pkl
      hash: md5
      md5: df5690cdd27db7ceb05eb0765c42d167
      size: 2553083
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 408746f5f6f15503eb3c7ac215524bf2
      size: 5351
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 0d4e736fc3ac87e1572f925c3379a405
      size: 2600
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: 39cad35ef7ea34f4a6e5ae51e56dbab4
      size: 5207
    - path: output/energy_metrics.json
      hash: md5
      md5: 7aee405a7a702bdac390a11709791900
      size: 179
    - path: output/energy_pinball_losses.svg
      hash: md5
      md5: d647efb0abb3568580fe230f0a4edc7b
      size: 26042
    - path: output/eval_plots/energy/
      hash: md5
      md5: 1445af631840a04e00385cfbc44323e5.dir
      size: 214020
      nfiles: 3
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: b959439375eb7d173888ddf4973848bf
      size: 64087
    - path: models/bikes_model.pkl
      hash: md5
      md5: fd71167879edec0e9fab176597b56697
      size: 1248377
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 408746f5f6f15503eb3c7ac215524bf2
      size: 5351
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 0d4e736fc3ac87e1572f925c3379a405
      size: 2600
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: 91c5339112ada3dd860b27fb738b7e07
      size: 19428
    - path: output/bikes_metrics.json
      hash: md5
      md5: 1782ea3125e70ecd39183bb87c4c99ab
      size: 181
    - path: output/bikes_pinball_losses.svg
      hash: md5
      md5: 5af719d8aaaba2de111ea42f356cdd5b
      size: 31910
    - path: output/eval_plots/bikes/
      hash: md5
      md5: b1f737a20217aede5d614a5291d12a0b.dir
      size: 94424
      nfiles: 3
