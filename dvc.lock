schema: '2.0'
stages:
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: bee8f75e753be0d27ded41cb062b911c
      size: 3349
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
          weather_features:
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: bbeb92186959e73e9a7746e2082c12a0
      size: 1284809
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: bee8f75e753be0d27ded41cb062b911c
      size: 3349
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
          weather_features:
          - temperature_2m_max
          - temperature_2m_min
          - daylight_duration
          - sunshine_duration
          - precipitation_sum
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: bc67b0999d2a34918a642212347afa97
      size: 149267
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: bbeb92186959e73e9a7746e2082c12a0
      size: 1284809
    - path: src/probafcst//models/
      hash: md5
      md5: cd2c52f6fd7d9eb2f9301ff55e53bdb2.dir
      size: 65118
      nfiles: 19
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 814639110f9c6e16e60a7d6cc4c593d7
      size: 5367
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
          weather_features:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          selected: catboost
          cutoff: '2015-10-23'
          benchmark:
            n_weeks: 100
          quantreg:
            kwargs:
              solver: highs-ipm
            lags:
            - 168
            include_seasonal_dummies: true
            include_rolling_stats: false
            cyclical_encodings: false
            X_lag_cols: []
          xgboost:
            freq: h
            output_chunk_length: 24
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            kwargs:
              n_jobs: -1
              random_state: 0
              n_estimators: 250
              tree_method: hist
              grow_policy: depthwise
              learning_rate: 0.1
              max_depth: 6
              colsample_bylevel: 0.6
              subsample: 0.8
              min_split_gain: 0.001
              reg_lambda: 0.001
          lgbm:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            include_rolling_stats: false
            kwargs:
              n_jobs: -1
              verbose: -1
              random_state: 0
              num_leaves: 20
              min_child_samples: 200
              n_estimators: 250
              max_depth: 12
              learning_rate: 0.1
              subsample_freq: 1
              subsample: 0.8
              reg_lambda: 2
              colsample_bytree: 0.6
          catboost:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols:
            kwargs:
              thread_count: -1
              learning_rate: 0.1
              n_estimators: 250
              random_state: 0
              verbose: 0
              max_depth: 6
              boosting_type: Plain
              reg_lambda: 0.01
              grow_policy: SymmetricTree
              colsample_bylevel: 0.6
              subsample: 0.8
          qrf:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols: []
            include_rolling_stats: false
            kwargs:
              n_estimators: 100
              random_state: 0
              n_jobs: -1
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: b68219be85dbc4ff0417f21fe8b422c5
      size: 3119773
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: bc67b0999d2a34918a642212347afa97
      size: 149267
    - path: src/probafcst//models/
      hash: md5
      md5: cd2c52f6fd7d9eb2f9301ff55e53bdb2.dir
      size: 65118
      nfiles: 19
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 814639110f9c6e16e60a7d6cc4c593d7
      size: 5367
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
          weather_features:
          - temperature_2m_max
          - temperature_2m_min
          - daylight_duration
          - sunshine_duration
          - precipitation_sum
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          selected: catboost
          cutoff: '2012-10-23'
          benchmark:
            n_weeks: 100
          quantreg:
            kwargs:
              solver: highs-ipm
            lags:
            - 7
            - 14
            include_seasonal_dummies: true
            include_rolling_stats: false
            cyclical_encodings: false
            X_lag_cols: []
          xgboost:
            freq: D
            output_chunk_length: 7
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 1
            - 2
            - 6
            - 7
            - 14
            - 21
            - 28
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols:
            kwargs:
              n_jobs: -1
              random_state: 0
              n_estimators: 250
              tree_method: hist
              grow_policy: depthwise
              learning_rate: 0.1
              max_depth: 6
              colsample_bylevel: 0.6
              subsample: 0.9
              min_split_gain: 0.001
              reg_lambda: 0.001
          lgbm:
            lags:
            - 1
            - 2
            - 6
            - 7
            - 8
            - 14
            - 21
            - 28
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols:
            kwargs:
              n_jobs: -1
              verbose: -1
              random_state: 0
              num_leaves: 15
              min_child_samples: 50
              n_estimators: 250
              max_depth: 9
              learning_rate: 0.1
              reg_lambda: 1
              colsample_bytree: 0.6
              subsample_freq: 1
              subsample: 0.9
          catboost:
            lags:
            - 1
            - 2
            - 6
            - 7
            - 14
            - 21
            - 28
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols:
            kwargs:
              thread_count: -1
              learning_rate: 0.1
              n_estimators: 250
              verbose: 0
              random_state: 0
              max_depth: 6
              boosting_type: Plain
              reg_lambda: 0.01
              grow_policy: SymmetricTree
              colsample_bylevel: 0.6
              subsample: 0.9
          qrf:
            lags:
            - 1
            - 2
            - 3
            - 7
            - 14
            - 21
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols: []
            kwargs:
              n_estimators: 100
              random_state: 0
              n_jobs: -1
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: ab717dd7e4d2e583be49d38c24885500
      size: 1056340
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: bbeb92186959e73e9a7746e2082c12a0
      size: 1284809
    - path: models/energy_model.pkl
      hash: md5
      md5: b68219be85dbc4ff0417f21fe8b422c5
      size: 3119773
    - path: src/probafcst//backtest.py
      hash: md5
      md5: c352b34254b7299b5ec810bac65b0949
      size: 6536
    - path: src/probafcst//metrics/
      hash: md5
      md5: 12a9187686c90eb86f5543e1b508397b.dir
      size: 14811
      nfiles: 8
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 814639110f9c6e16e60a7d6cc4c593d7
      size: 5367
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: b8b98e69be77896f7b7a00fecdf347d2
      size: 3144
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          eval_start: '2023-10-23'
          eval_end: '2024-10-23'
          bikes:
            forecast_steps_days: 7
            step_length_days: 7
          energy:
            forecast_steps_days: 7
            step_length_days: 7
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: de719434ed5683dd8ba72461363eecb8
      size: 9353
    - path: output/energy_metrics.json
      hash: md5
      md5: 39d70e3d99e8d63c5bfde6469a6386d1
      size: 581
    - path: output/energy_pinball_losses.svg
      hash: md5
      md5: ed175dbb9834caa04cf655f71a1537e9
      size: 26080
    - path: output/eval_plots/energy/
      hash: md5
      md5: f72cfb869569a75d0c1c11b1f57f5a47.dir
      size: 323933
      nfiles: 5
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: bc67b0999d2a34918a642212347afa97
      size: 149267
    - path: models/bikes_model.pkl
      hash: md5
      md5: ab717dd7e4d2e583be49d38c24885500
      size: 1056340
    - path: src/probafcst//backtest.py
      hash: md5
      md5: c352b34254b7299b5ec810bac65b0949
      size: 6536
    - path: src/probafcst//metrics/
      hash: md5
      md5: 12a9187686c90eb86f5543e1b508397b.dir
      size: 14811
      nfiles: 8
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 814639110f9c6e16e60a7d6cc4c593d7
      size: 5367
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: b8b98e69be77896f7b7a00fecdf347d2
      size: 3144
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          eval_start: '2023-10-23'
          eval_end: '2024-10-23'
          bikes:
            forecast_steps_days: 7
            step_length_days: 7
          energy:
            forecast_steps_days: 7
            step_length_days: 7
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: 2a1a75df87b11f141dbf436cd0cb5e75
      size: 8640
    - path: output/bikes_metrics.json
      hash: md5
      md5: 3fe7bab5c761ff3af3a30ccde11966f6
      size: 584
    - path: output/bikes_pinball_losses.svg
      hash: md5
      md5: 050ac163a84a38b4caeff7d8d4a56148
      size: 28040
    - path: output/eval_plots/bikes/
      hash: md5
      md5: 24f0a38277680f35a67b275492c1a8f5.dir
      size: 168697
      nfiles: 5
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: ab717dd7e4d2e583be49d38c24885500
      size: 1056340
    - path: models/energy_model.pkl
      hash: md5
      md5: b68219be85dbc4ff0417f21fe8b422c5
      size: 3119773
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: 281f1a642c30c54376b0a2306c8d1b02
      size: 2371
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.svg
      hash: md5
      md5: 76ec2b7c4c221011e72b1aa21a976273
      size: 33614
    - path: output/energy_forecast.svg
      hash: md5
      md5: acf4f5d401d79ee58a0ab116b3bb9ce1
      size: 67202
    - path: output/submission.csv
      hash: md5
      md5: 977aef0020e75c9bb782f812518f2ad2
      size: 1609
