schema: '2.0'
stages:
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 309c5ac9a71d2f3be569056bf623902d
      size: 3144
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: 78144f75f1cf774f63d063d6aa4d2bcf
      size: 2181304
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 309c5ac9a71d2f3be569056bf623902d
      size: 3144
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: 5999d39609e27560c53205f50cc9e707
      size: 161274
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 78144f75f1cf774f63d063d6aa4d2bcf
      size: 2181304
    - path: src/probafcst//models/
      hash: md5
      md5: 14506a621594e5c19cfdf8e68c50585f.dir
      size: 25559
      nfiles: 8
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          selected: xgb-custom
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            freq: h
            output_chunk_length: 24
          xgboost:
            freq: h
            output_chunk_length: 24
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: 63dc2aa476b5306dfd80094ff2fda9be
      size: 3315505
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 5999d39609e27560c53205f50cc9e707
      size: 161274
    - path: src/probafcst//models/
      hash: md5
      md5: 14506a621594e5c19cfdf8e68c50585f.dir
      size: 25559
      nfiles: 8
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          selected: xgb-custom
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            freq: D
            output_chunk_length: 7
          xgboost:
            freq: D
            output_chunk_length: 7
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 1
            - 2
            - 3
            - 7
            - 14
            - 21
            - 28
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: c71a6678b5b2d4d4b6911e5c4003f2c3
      size: 1233650
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 78144f75f1cf774f63d063d6aa4d2bcf
      size: 2181304
    - path: models/energy_model.pkl
      hash: md5
      md5: 63dc2aa476b5306dfd80094ff2fda9be
      size: 3315505
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 408746f5f6f15503eb3c7ac215524bf2
      size: 5351
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 924860f2a82c3fbe10a84de59038987b
      size: 2743
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: bab50864b27899aa0d0f97ef48e0eef2
      size: 5249
    - path: output/energy_metrics.json
      hash: md5
      md5: d88bfc8aef019923e0f60fce7473fa6e
      size: 180
    - path: output/energy_pinball_losses.svg
      hash: md5
      md5: e596c9215fa526a6c338eda0a2021afa
      size: 28415
    - path: output/eval_plots/energy/
      hash: md5
      md5: 8d22c43f2b149ea3da92555f8d3df511.dir
      size: 213816
      nfiles: 3
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 5999d39609e27560c53205f50cc9e707
      size: 161274
    - path: models/bikes_model.pkl
      hash: md5
      md5: c71a6678b5b2d4d4b6911e5c4003f2c3
      size: 1233650
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 408746f5f6f15503eb3c7ac215524bf2
      size: 5351
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 924860f2a82c3fbe10a84de59038987b
      size: 2743
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: 40b288498b56f9981f3817e3d6f552e2
      size: 19371
    - path: output/bikes_metrics.json
      hash: md5
      md5: 4ac92d7ef108c610f4970b3ff260c966
      size: 180
    - path: output/bikes_pinball_losses.svg
      hash: md5
      md5: 4e74a55f9708489d5864c3851f1c8dad
      size: 28900
    - path: output/eval_plots/bikes/
      hash: md5
      md5: 68e85f57c9dbfa749a0ae64ad3783732.dir
      size: 97834
      nfiles: 3
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: c71a6678b5b2d4d4b6911e5c4003f2c3
      size: 1233650
    - path: models/energy_model.pkl
      hash: md5
      md5: 63dc2aa476b5306dfd80094ff2fda9be
      size: 3315505
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: 5814730fcd94177ce2b4f7298bdf3996
      size: 2149
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.svg
      hash: md5
      md5: 8a1b87556f3ec45cc0233429fdac7244
      size: 31962
    - path: output/energy_forecast.svg
      hash: md5
      md5: b0ddac623655b5f0ba2d7ed77591a278
      size: 69478
    - path: output/submission.csv
      hash: md5
      md5: b2d7468f3d9a326305364ac91db0cf3e
      size: 1556
