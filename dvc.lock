schema: '2.0'
stages:
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5f593f1618ac05996211c7ce54895a1d
      size: 3349
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
          weather_features:
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: bdac8f16adf0a607037b686254be4a5d
      size: 1278514
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 243781d97fb6bcad9477cea2544bea5a
      size: 3972
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5f593f1618ac05996211c7ce54895a1d
      size: 3349
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
          weather_features:
          - temperature_2m_max
          - temperature_2m_min
          - daylight_duration
          - sunshine_duration
          - precipitation_sum
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: 48a552f8268d3ba345b6e017977a19c7
      size: 148671
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: bdac8f16adf0a607037b686254be4a5d
      size: 1278514
    - path: src/probafcst//models/
      hash: md5
      md5: 6c34ee536ebc014548e4f207c1eedb09.dir
      size: 27431
      nfiles: 8
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 20b1a00caed3c407c77056b04bd5fa4a
      size: 5805
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
          target_col: load
          weather_features:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          selected: catboost
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            kwargs:
              solver: highs-ipm
            lags:
            - 1
            - 2
            - 3
            - 24
            - 48
            - 168
            include_seasonal_dummies: true
            include_rolling_stats: false
            cyclical_encodings: false
            X_lag_cols:
          xgboost:
            freq: h
            output_chunk_length: 24
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            kwargs:
              n_jobs: -1
              random_state: 0
          lgbm:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            include_rolling_stats: false
            kwargs:
              n_jobs: -1
              verbose: -1
              random_state: 0
          catboost:
            lags:
            - 24
            - 48
            - 72
            - 96
            - 120
            - 144
            - 168
            - 336
            - 504
            - 672
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            kwargs:
              n_estimators: 100
              random_state: 0
              verbose: 0
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: 5675d9cad80c561dc611a12f9b3aa9a7
      size: 1132018
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 48a552f8268d3ba345b6e017977a19c7
      size: 148671
    - path: src/probafcst//models/
      hash: md5
      md5: 6c34ee536ebc014548e4f207c1eedb09.dir
      size: 27431
      nfiles: 8
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 20b1a00caed3c407c77056b04bd5fa4a
      size: 5805
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: f76a84ee80300ed55740666fe147ec40
      size: 1315
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
          target_col: bike_count
          weather_features:
          - temperature_2m_max
          - temperature_2m_min
          - daylight_duration
          - sunshine_duration
          - precipitation_sum
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          selected: catboost
          cutoff: '2021-11-14'
          benchmark:
            n_weeks: 100
          quantreg:
            kwargs:
              solver: highs-ipm
            lags:
            - 1
            - 2
            - 7
            - 14
            include_seasonal_dummies: true
            include_rolling_stats: false
            cyclical_encodings: false
            X_lag_cols:
          xgboost:
            freq: D
            output_chunk_length: 7
            xgb_kwargs:
              n_jobs: -1
          xgb-custom:
            lags:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 6
            - 7
            - 14
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            kwargs:
              n_jobs: -1
              random_state: 0
          lgbm:
            lags:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 6
            - 7
            - 14
            include_seasonal_dummies: true
            cyclical_encodings: true
            include_rolling_stats: false
            X_lag_cols:
            kwargs:
              n_jobs: -1
              verbose: -1
              random_state: 0
          catboost:
            lags:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 6
            - 7
            - 14
            include_seasonal_dummies: true
            cyclical_encodings: true
            X_lag_cols:
            kwargs:
              n_estimators: 100
              verbose: 0
              random_state: 0
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: 48cf70c2041e7c5aa31a5108f745ee67
      size: 408470
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: bdac8f16adf0a607037b686254be4a5d
      size: 1278514
    - path: models/energy_model.pkl
      hash: md5
      md5: 5675d9cad80c561dc611a12f9b3aa9a7
      size: 1132018
    - path: src/probafcst//backtest.py
      hash: md5
      md5: c352b34254b7299b5ec810bac65b0949
      size: 6536
    - path: src/probafcst//metrics/
      hash: md5
      md5: 2c25f7181ab2c0af41915f5a28e8d755.dir
      size: 6210
      nfiles: 4
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 20b1a00caed3c407c77056b04bd5fa4a
      size: 5805
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: bedc55975710762e19c84c530584ab9a
      size: 3031
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: a75192652f0059ea85e89bb226bca999
      size: 5248
    - path: output/energy_metrics.json
      hash: md5
      md5: 731f62ec9eef1e818c2a8d00aa1726d4
      size: 582
    - path: output/energy_pinball_losses.svg
      hash: md5
      md5: aac27dea11c20fc3f59781013431f333
      size: 24968
    - path: output/eval_plots/energy/
      hash: md5
      md5: 866f39d56316b5159a15e534023351a7.dir
      size: 254405
      nfiles: 4
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: 48a552f8268d3ba345b6e017977a19c7
      size: 148671
    - path: models/bikes_model.pkl
      hash: md5
      md5: 48cf70c2041e7c5aa31a5108f745ee67
      size: 408470
    - path: src/probafcst//backtest.py
      hash: md5
      md5: c352b34254b7299b5ec810bac65b0949
      size: 6536
    - path: src/probafcst//metrics/
      hash: md5
      md5: 2c25f7181ab2c0af41915f5a28e8d755.dir
      size: 6210
      nfiles: 4
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/tabularization.py
      hash: md5
      md5: 20b1a00caed3c407c77056b04bd5fa4a
      size: 5805
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: bedc55975710762e19c84c530584ab9a
      size: 3031
    params:
      params.yaml:
        eval:
          backend: loky
          splitter_type: sliding
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: c583c837730498049b1ba41c13681ef5
      size: 19619
    - path: output/bikes_metrics.json
      hash: md5
      md5: b775410d58af7841427ebc3faca3c303
      size: 579
    - path: output/bikes_pinball_losses.svg
      hash: md5
      md5: 2cb0b8e3e3ec25bd0fd7a99117fd1448
      size: 31927
    - path: output/eval_plots/bikes/
      hash: md5
      md5: 0a51219231cb06c449cbf06b2cae02b2.dir
      size: 137257
      nfiles: 4
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: 48cf70c2041e7c5aa31a5108f745ee67
      size: 408470
    - path: models/energy_model.pkl
      hash: md5
      md5: 5675d9cad80c561dc611a12f9b3aa9a7
      size: 1132018
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: 050533d9a1d7cb7b916d1726c246a5e2
      size: 2231
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.svg
      hash: md5
      md5: 07985eb092525b251a89225c92ba973e
      size: 30895
    - path: output/energy_forecast.svg
      hash: md5
      md5: 69fade9b57f380be4386734456645c1e
      size: 67301
    - path: output/submission.csv
      hash: md5
      md5: 69ed99322d228bc7cf6bd98c27ea299f
      size: 1608
