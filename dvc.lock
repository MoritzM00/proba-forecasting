schema: '2.0'
stages:
  prepare:
    cmd: uv run python src/probafcst/pipeline/prepare.py
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 6d59fa3c8a1c02fca7f10e251db64a2a
      size: 3645
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 4a10769d280f0d261a5c2ec241080c40
      size: 1433
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: ad440470ca62eaef0beb641f52577331
      size: 523826
  prepare@energy:
    cmd: python src/probafcst/pipeline/prepare.py --target energy
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 097aa94f1a566899a3b7183644bf1083
      size: 3917
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 1221e8deea12df360f3d4002e4b09536
      size: 2092
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
    outs:
    - path: data/energy.parquet
      hash: md5
      md5: 4791779e0c7033ec89a11486352d5cf9
      size: 1325417
  prepare@bikes:
    cmd: python src/probafcst/pipeline/prepare.py --target bikes
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 097aa94f1a566899a3b7183644bf1083
      size: 3917
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 1221e8deea12df360f3d4002e4b09536
      size: 2092
    params:
      params.yaml:
        cache:
          enable: true
          days_expire_after: 5
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
    outs:
    - path: data/bikes.parquet
      hash: md5
      md5: ccbdca31a35c759315a9256abe1d62f3
      size: 63848
  prepare@no2:
    cmd: uv run python src/probafcst/pipeline/prepare.py --target no2
    deps:
    - path: src/probafcst//data.py
      hash: md5
      md5: 9ebb26cb2d17806d29968a9235425167
      size: 3798
    - path: src/probafcst/pipeline/prepare.py
      hash: md5
      md5: 5437a9e458ff6638d74d4273b802a380
      size: 2130
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
  train@energy:
    cmd: python src/probafcst/pipeline/train.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 4791779e0c7033ec89a11486352d5cf9
      size: 1325417
    - path: src/probafcst//models/
      hash: md5
      md5: 05927e6b4a69c902edcc9ef9e5608681.dir
      size: 17582
      nfiles: 7
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 3246cfca1dec896cea976e5e8b15dc9b
      size: 975
    params:
      params.yaml:
        data.energy:
          filename: energy.parquet
          ignore_years: 0
          freq: h
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.energy:
          selected: quantreg
          benchmark:
            n_weeks: 75
          quantreg:
            freq: ${data.energy.freq}
            output_chunk_length: 24
            quantiles: ${quantiles}
          xgboost:
            freq: ${data.energy.freq}
            quantiles: ${quantiles}
            output_chunk_length: 24
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/energy_model.pkl
      hash: md5
      md5: f60f43952b334ec255cf40109695404c
      size: 9026696
  train@bikes:
    cmd: python src/probafcst/pipeline/train.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: ccbdca31a35c759315a9256abe1d62f3
      size: 63848
    - path: src/probafcst//models/
      hash: md5
      md5: 05927e6b4a69c902edcc9ef9e5608681.dir
      size: 17582
      nfiles: 7
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: 3246cfca1dec896cea976e5e8b15dc9b
      size: 975
    params:
      params.yaml:
        data.bikes:
          filename: bikes.parquet
          start_date: '2012-04-25'
          freq: D
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
        train.bikes:
          selected: quantreg
          benchmark:
            n_weeks: 125
          quantreg:
            freq: ${data.bikes.freq}
            output_chunk_length: 7
            quantiles: ${quantiles}
          xgboost:
            freq: ${data.bikes.freq}
            quantiles: ${quantiles}
            output_chunk_length: 7
            xgb_kwargs:
              n_jobs: -1
    outs:
    - path: models/bikes_model.pkl
      hash: md5
      md5: 9e7186392be081e229b0e2bbca8f74b0
      size: 420958
  train@no2:
    cmd: uv run python src/probafcst/pipeline/train.py --target no2
    deps:
    - path: data/no2.parquet
      hash: md5
      md5: c0f37fa6ec1865b682bb3add8ed17c39
      size: 801854
    - path: src/probafcst//model.py
      hash: md5
      md5: 4012051ff8e014e21b0f2f762341189c
      size: 881
    - path: src/probafcst/pipeline/train.py
      hash: md5
      md5: b986f3cb2605277a0930bd3c713b38d8
      size: 965
    params:
      params.yaml:
        data.no2:
          filename: no2.parquet
          start_date: '2016-01-01'
          end_date: '2024-10-26'
    outs:
    - path: models/no2_model.pkl
      hash: md5
      md5: ae97b7c132b660aacc13eb0bf3c76ac5
      size: 1857779
  submit:
    cmd: python src/probafcst/pipeline/submit.py
    deps:
    - path: models/bikes_model.pkl
      hash: md5
      md5: 9e7186392be081e229b0e2bbca8f74b0
      size: 420958
    - path: models/energy_model.pkl
      hash: md5
      md5: f60f43952b334ec255cf40109695404c
      size: 9026696
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst//utils/check_submission.py
      hash: md5
      md5: 34b7c6453e8c63b3a0963426a3fc29bf
      size: 6425
    - path: src/probafcst//utils/create_submission.py
      hash: md5
      md5: ed9ef8fd99a4cd18be4d357214e04fc4
      size: 3407
    - path: src/probafcst/pipeline/submit.py
      hash: md5
      md5: 41de7ff7d0e4523166801400aec741af
      size: 1948
    params:
      params.yaml:
        quantiles:
        - 0.025
        - 0.25
        - 0.5
        - 0.75
        - 0.975
    outs:
    - path: output/bikes_forecast.png
      hash: md5
      md5: 5e148defcfc3252fa5eebb49a406e2f7
      size: 54679
    - path: output/energy_forecast.png
      hash: md5
      md5: d6d39a574ed045a2d5d731ac3ae27c99
      size: 69034
    - path: output/submission.csv
      hash: md5
      md5: ded0fd82913faceab58c2ab860eae7a7
      size: 1561
  eval@energy:
    cmd: python src/probafcst/pipeline/evaluate.py --target energy
    deps:
    - path: data/energy.parquet
      hash: md5
      md5: 4791779e0c7033ec89a11486352d5cf9
      size: 1325417
    - path: models/energy_model.pkl
      hash: md5
      md5: f60f43952b334ec255cf40109695404c
      size: 9026696
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 4d82d1d23596bd30951b1ddfff18a702
      size: 4350
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 87893c2b2a3be9421f37883a3c014609
      size: 2458
    params:
      params.yaml:
        eval:
          backend: loky
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/energy_eval_results.csv
      hash: md5
      md5: 480033a7391ddfbd1b9b7f1cab9becd9
      size: 4712
    - path: output/energy_metrics.json
      hash: md5
      md5: 196cd8dc8ea58c14afaaadc87fc5b390
      size: 174
    - path: output/energy_pinball_losses.png
      hash: md5
      md5: 13e400d2ace5b97175a34c455c383ac3
      size: 13637
    - path: output/eval_plots/energy/
      hash: md5
      md5: 02a15d72e5a3d255d12c29113836490b.dir
      size: 365256
      nfiles: 3
  eval@bikes:
    cmd: python src/probafcst/pipeline/evaluate.py --target bikes
    deps:
    - path: data/bikes.parquet
      hash: md5
      md5: ccbdca31a35c759315a9256abe1d62f3
      size: 63848
    - path: models/bikes_model.pkl
      hash: md5
      md5: 9e7186392be081e229b0e2bbca8f74b0
      size: 420958
    - path: src/probafcst//backtest.py
      hash: md5
      md5: 4d82d1d23596bd30951b1ddfff18a702
      size: 4350
    - path: src/probafcst//plotting.py
      hash: md5
      md5: 482a42cf8b0b9196d98b0d8e772d83d2
      size: 1780
    - path: src/probafcst/pipeline/evaluate.py
      hash: md5
      md5: 87893c2b2a3be9421f37883a3c014609
      size: 2458
    params:
      params.yaml:
        eval:
          backend: loky
          bikes:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 30
          energy:
            forecast_steps_days: 7
            n_years_initial_window: 3
            step_length_days: 90
    outs:
    - path: output/bikes_eval_results.csv
      hash: md5
      md5: 871e92fd52d9aec24b7bca05b006eecd
      size: 19399
    - path: output/bikes_metrics.json
      hash: md5
      md5: 530f8ad0b22794e9d3501514ef4667d0
      size: 182
    - path: output/bikes_pinball_losses.png
      hash: md5
      md5: d8ed6085c6e3eb3262c1bfb8338f4c8c
      size: 18944
    - path: output/eval_plots/bikes/
      hash: md5
      md5: fc020cfeac1544fd244c54e0c17c37a4.dir
      size: 191186
      nfiles: 3
